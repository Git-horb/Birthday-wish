<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy Birthday Emily ðŸŽ‰</title>
<style>
  /* Minimal, self-contained styles â€” no external resources */
  :root{
    --bg1:#0b0016; --bg2:#2f003f; --accent1:#ff6fb5; --accent2:#9b7cff; --soft:#fff2ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; -webkit-font-smoothing:antialiased}
  body{
    background: linear-gradient(270deg,var(--bg1),var(--bg2),#12001a);
    background-size: 600% 600%;
    animation: aurora 18s ease infinite;
    color:var(--soft);
    display:flex; align-items:center; justify-content:center; padding:20px;
  }
  @keyframes aurora {
    0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}
  }

  .card{
    width:100%; max-width:980px; border-radius:16px; overflow:hidden; position:relative;
    padding:18px; display:grid; grid-template-columns: 1fr 360px; gap:16px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow: 0 18px 60px rgba(0,0,0,0.6);
  }
  @media (max-width:920px){ .card{grid-template-columns:1fr} .side{order:2} }

  /* left (main) */
  .main{padding:10px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:14px}
  h1{font-size:20px; color:var(--accent1); margin:4px 0 0; text-shadow:0 6px 30px rgba(155,124,255,0.08)}
  .subtitle{color:rgba(255,242,255,0.78); font-size:13px}
  .photo{width:180px; height:180px; border-radius:16px; object-fit:cover; box-shadow:0 10px 30px rgba(0,0,0,0.5); border:1px solid rgba(255,255,255,0.04)}

  .timer{
    display:flex; gap:8px; margin-top:6px; flex-wrap:wrap; justify-content:center;
  }
  .unit{
    min-width:76px; padding:12px 10px; border-radius:12px; text-align:center;
    background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);
    border:1px solid rgba(255,255,255,0.03);
  }
  .unit strong{display:block; font-size:26px}
  .unit small{display:block; margin-top:6px; color:rgba(255,242,255,0.72)}

  .controls{display:flex; gap:10px; margin-top:10px; flex-wrap:wrap; justify-content:center}
  .btn{padding:10px 14px; border-radius:12px; border:0; cursor:pointer; font-weight:700; background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:#160017}
  .btn.alt{background:transparent; color:var(--soft); border:1px solid rgba(255,255,255,0.06)}

  /* right (side) */
  .side{padding:12px; display:flex; flex-direction:column; gap:10px}
  .card-title{display:flex; gap:10px; align-items:center}
  .badge{width:48px;height:48px;border-radius:10px; display:grid; place-items:center; font-weight:700; background:linear-gradient(135deg,var(--accent2),var(--accent1))}
  .wish-list{display:flex; flex-direction:column; gap:10px; overflow:auto; max-height:360px; padding-right:6px}
  .wish{background:rgba(255,255,255,0.015); border-radius:10px; padding:10px; border:1px solid rgba(255,255,255,0.02)}
  .quote{font-style:italic; color:rgba(255,242,255,0.86)}

  /* celebration overlay */
  .celebrate{
    position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center;
    background: radial-gradient(600px 300px at 50% 25%, rgba(155,124,255,0.06), transparent 20%), rgba(11,0,20,0.38);
    z-index:40; gap:14px; padding:28px; border-radius:16px;
    opacity:0; pointer-events:none; transform:scale(1.02); transition:all 560ms cubic-bezier(.16,.8,.4,1);
  }
  .celebrate.show{opacity:1; pointer-events:auto; transform:scale(1)}

  .glow-title{font-size:28px; font-weight:800; letter-spacing:0.4px; color:var(--accent1); text-shadow: 0 10px 30px rgba(255,111,181,0.08)}
  .cake{
    width:220px; height:180px; border-radius:16px; background:linear-gradient(180deg,#fff8ff,#ffeef6); display:flex; align-items:center; justify-content:center; position:relative; box-shadow:0 16px 50px rgba(0,0,0,0.45)
  }
  .candles{position:absolute; top:-30px; left:50%; transform:translateX(-50%); display:flex; gap:8px}
  .candle{width:8px; height:36px; background:linear-gradient(180deg,#ffd7a6,#ff9b6a); border-radius:6px; position:relative; box-shadow:0 6px 18px rgba(0,0,0,0.25)}
  .flicker{position:absolute; top:-22px; left:50%; transform:translateX(-50%); font-size:18px; filter:drop-shadow(0 6px 16px rgba(255,140,0,0.45)); animation:flick 900ms infinite}
  @keyframes flick{0%{opacity:0.6; transform:translateX(-50%) scale(0.92)}50%{opacity:1; transform:translateX(-50%) scale(1.08)}100%{opacity:0.7; transform:translateX(-50%) scale(0.95)}}

  .messages{max-width:820px; text-align:center; color:var(--soft)}

  /* floating particles (hearts/stars) */
  .particles{pointer-events:none; position:absolute; inset:0; z-index:35}
  .particle{position:absolute; font-size:18px; opacity:0.9; transform-origin:center; animation:floatUp linear infinite}
  @keyframes floatUp{0%{transform:translateY(20vh) scale(0.9)}100%{transform:translateY(-110vh) scale(1.05) rotate(360deg)}}

  footer{margin-top:10px; text-align:center; font-size:13px; color:rgba(255,242,255,0.45)}
</style>
</head>
<body>
  <div class="card" role="main" aria-live="polite">
    <div class="main">
      <div style="display:flex;flex-direction:column;align-items:center;">
        <h1>For Emily â€” Friendly Birthday Surprise</h1>
        <div class="subtitle" id="subLabel">Countdown (Cambodia time)</div>
        <img id="mainPhoto" class="photo" src="https://cdn.davex.site/cdn/image/Beede.png" alt="Emily photo">
      </div>

      <div class="timer" aria-hidden="false" style="margin-top:6px">
        <div class="unit"><strong id="days">0</strong><small>days</small></div>
        <div class="unit"><strong id="hours">00</strong><small>hours</small></div>
        <div class="unit"><strong id="minutes">00</strong><small>minutes</small></div>
        <div class="unit"><strong id="seconds">00</strong><small>seconds</small></div>
      </div>

      <div class="controls">
        <button id="playBtn" class="btn">ðŸŽµ Play Song</button>
        <button id="singBtn" class="btn alt">ðŸŽ¤ Sing (TTS)</button>
        <button id="forceBtn" class="btn alt">âœ¨ Celebrate now</button>
      </div>
    </div>

    <aside class="side">
      <div class="card-title">
        <div class="badge">ðŸ’–</div>
        <div>
          <div style="font-weight:700">Notes & Wishes</div>
          <div style="font-size:13px;color:rgba(255,242,255,0.66)">Friendly, warm, and sincere messages</div>
        </div>
      </div>

      <div class="wish-list">
        <div class="wish">
          <div style="font-weight:700">A warm friend note</div>
          <div style="margin-top:8px">Emily â€” your laughter makes ordinary days better. Wishing you calm mornings and bright evenings.</div>
        </div>

        <div class="wish">
          <div style="font-weight:700">Short & honest</div>
          <div style="margin-top:8px">Youâ€™re kind, you're real, and you deserve all the little joys today brings.</div>
        </div>

        <div class="wish quote">"We do not remember days, we remember moments." â€” Cesare Pavese</div>

        <div class="wish">
          <div style="font-weight:700">Final friendly wish</div>
          <div style="margin-top:8px">May this year bring new smiles, new friends, and small daily wins that feel like home.</div>
        </div>

        <div style="display:flex;gap:8px;justify-content:center;margin-top:8px">
          <button id="downloadBtn" class="btn alt">Download page</button>
          <button id="openBtn" class="btn alt">Open in new tab</button>
        </div>
      </div>
    </aside>

    <!-- celebration overlay -->
    <div class="celebrate" id="celebrateOverlay" aria-hidden="true">
      <div class="glow-title">Happy Birthday, Emily ðŸŽ‰</div>
      <div class="cake" role="img" aria-label="Birthday cake">
        <div class="candles">
          <div class="candle"></div><div class="candle"></div><div class="candle"></div>
        </div>
        <div style="font-weight:700;color:#5b2745">Make a wish âœ¨</div>
      </div>

      <div class="messages" id="messagesContainer"></div>

      <div style="display:flex; gap:10px; margin-top:8px;">
        <button id="replayBtn" class="btn alt">Replay Celebration</button>
        <button id="closeBtn" class="btn alt">Close</button>
      </div>
    </div>

    <div class="particles" id="particles"></div>
  </div>

  <footer>Made with care â€” Friendly & warm wishes for Emily ðŸ’Œ</footer>

<script>
/* ========== User-replaceable audio link ==========
   Replace SAMPLE_AUDIO_URL with your CDN audio (MP3) if you want a recorded song.
*/
const SAMPLE_AUDIO_URL = 'https://cdn.davex.site/cdn/audio/emily-happy-birthday.mp3'; // <-- replace when ready
/* =================================================*/

/* ---------- Timezone-safe target (Asia/Phnom_Penh, UTC+7) ---------- */
// target day (Nov 7) 00:00 in Cambodia (UTC+7)
const TARGET_MONTH = 10; // November (0-indexed)
const TARGET_DAY = 7;
const KH_OFFSET = 7; // hours ahead of UTC

function getTargetUTCForYear(year){
  // We want the UTC ms that corresponds to (year, Nov 7, 00:00) in UTC+7.
  // Creating Date.UTC(year, month, day, -KH_OFFSET) shifts correctly to UTC moment.
  return Date.UTC(year, TARGET_MONTH, TARGET_DAY, -KH_OFFSET, 0, 0, 0);
}

// Build current KH-local date parts to decide which year we target
function nowInKH(){
  const parts = new Intl.DateTimeFormat('en-GB', {
    timeZone: 'Asia/Phnom_Penh',
    year:'numeric', month:'numeric', day:'numeric', hour:'numeric', minute:'numeric', second:'numeric'
  }).formatToParts(new Date());
  const p = {};
  parts.forEach(x=>p[x.type]=x.value);
  return new Date(p.year, Number(p.month)-1, p.day, p.hour, p.minute, p.second);
}

let khNow = nowInKH();
let targetYear = khNow.getFullYear();
let targetUTC = getTargetUTCForYear(targetYear);
if (khNow.getFullYear()>=(new Date(targetUTC).getUTCFullYear()) && (nowInKH().getMonth() > new Date(targetUTC).getUTCMonth() || nowInKH().getDate() >= new Date(targetUTC).getUTCDate())) {
  // if today in KH is on/after Nov 7, use next year
  targetYear = targetYear + 1;
  targetUTC = getTargetUTCForYear(targetYear);
}
const targetDate = new Date(targetUTC);

/* ---------- Elements ---------- */
const elDays = document.getElementById('days');
const elHours = document.getElementById('hours');
const elMinutes = document.getElementById('minutes');
const elSeconds = document.getElementById('seconds');
const subLabel = document.getElementById('subLabel');
const celebrateOverlay = document.getElementById('celebrateOverlay');
const messagesContainer = document.getElementById('messagesContainer');
const particlesRoot = document.getElementById('particles');

subLabel.textContent = `Counting down to ${new Intl.DateTimeFormat(undefined,{ timeZone:'Asia/Phnom_Penh', weekday:'long', year:'numeric', month:'long', day:'numeric'}).format(targetDate)} (Cambodia time)`;

/* ---------- Countdown logic (UTC-safe) ---------- */
let countdownInterval;
function updateCountdown(){
  const nowUTC = Date.now(); // ms UTC
  const diff = targetDate.getTime() - nowUTC;
  if (diff <= 0){
    // trigger celebration once and stop
    clearInterval(countdownInterval);
    openCelebration();
    return;
  }
  const s = Math.floor(diff/1000);
  const days = Math.floor(s/86400);
  const hours = Math.floor((s%86400)/3600);
  const minutes = Math.floor((s%3600)/60);
  const seconds = s%60;
  elDays.textContent = String(days);
  elHours.textContent = String(hours).padStart(2,'0');
  elMinutes.textContent = String(minutes).padStart(2,'0');
  elSeconds.textContent = String(seconds).padStart(2,'0');
}
updateCountdown();
countdownInterval = setInterval(updateCountdown, 1000);

/* ---------- Particles generator (hearts/stars) ---------- */
function spawnParticle(){
  const el = document.createElement('div');
  el.className = 'particle';
  const isHeart = Math.random() > 0.6;
  el.textContent = isHeart ? 'â¤' : (Math.random()>0.5 ? 'âœ¦' : 'âœ¶');
  el.style.left = (5 + Math.random()*90) + '%';
  el.style.top = (85 + Math.random()*10) + '%';
  el.style.fontSize = (10 + Math.random()*26) + 'px';
  el.style.animationDuration = (8 + Math.random()*12) + 's';
  particlesRoot.appendChild(el);
  setTimeout(()=>{ el.remove(); }, 14000);
}
setInterval(spawnParticle, 350);

/* ---------- Celebration visuals & messages (friendly tone) ---------- */
const friendlyMessages = [
  "Hey Emily â€” happy birthday!",
  "I hope today gives you calm mornings, easy laughter, and small moments that feel like a cozy surprise.",
  "Youâ€™re a truly kind friend. You make ordinary days better just by being you.",
  "Wishing you a year full of gentle wins, good music, and warm company.",
  "Enjoy every little thing today â€” you deserve it. ðŸŽˆ",
  "From someone whoâ€™s really glad to know you â€” happy birthday, Emily."
];

function openCelebration(){
  // show overlay
  celebrateOverlay.classList.add('show');
  celebrateOverlay.setAttribute('aria-hidden','false');

  // populate messages line-by-line
  messagesContainer.innerHTML = '';
  let i = 0;
  function nextLine(){
    if (i >= friendlyMessages.length) return;
    const p = document.createElement('div');
    p.style.margin = '8px 0';
    p.style.fontSize = '15px';
    p.textContent = friendlyMessages[i];
    messagesContainer.appendChild(p);
    i++;
    setTimeout(nextLine, 1800);
  }
  nextLine();

  // start lightweight confetti (canvas)
  startConfetti();

  // try to autoplay audio; may be blocked on some browsers â€” user can press Play
  tryPlayAudio();
}

/* ---------- Confetti (lightweight canvas ribbons) ---------- */
let confettiRAF;
function startConfetti(){
  const canvas = document.createElement('canvas');
  canvas.style.position='absolute'; canvas.style.inset='0'; canvas.style.pointerEvents='none'; canvas.style.zIndex=42;
  document.body.appendChild(canvas);
  const ctx = canvas.getContext('2d');
  function resize(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
  resize(); window.addEventListener('resize', resize);
  const pieces = [];
  const colors = ['#ff6fb5','#ffd27f','#9b7cff','#66e0ff','#fff4cc'];
  for(let i=0;i<140;i++){
    pieces.push({ x: Math.random()*canvas.width, y: Math.random()*-canvas.height, r:6+Math.random()*10, vx:(Math.random()-0.5)*1.2, vy:2+Math.random()*3, color: colors[Math.floor(Math.random()*colors.length)], rot: Math.random()*360});
  }
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(const p of pieces){
      p.x += p.vx; p.y += p.vy; p.rot += 4;
      ctx.save();
      ctx.translate(p.x,p.y);
      ctx.rotate(p.rot * Math.PI/180);
      ctx.fillStyle = p.color;
      ctx.fillRect(-p.r/2, -p.r/2, p.r, p.r*0.6);
      ctx.restore();
      if (p.y > canvas.height + 40){ p.y = -40; p.x = Math.random()*canvas.width; }
    }
    confettiRAF = requestAnimationFrame(draw);
  }
  draw();
  // stop after a while
  setTimeout(()=>{ cancelAnimationFrame(confettiRAF); canvas.remove(); }, 18000);
}

/* ---------- Audio handling (use your CDN) ---------- */
let audioEl;
function ensureAudio(){
  if (!audioEl){
    audioEl = document.createElement('audio');
    audioEl.src = SAMPLE_AUDIO_URL;
    audioEl.preload = 'auto';
    audioEl.style.display = 'none';
    document.body.appendChild(audioEl);
  }
}
async function tryPlayAudio(){
  ensureAudio();
  try { await audioEl.play(); } catch(e){ /* autoplay blocked â€” user interaction required */ }
}

/* ---------- TTS sing (friendly short) ---------- */
function singTTS(){
  if (!('speechSynthesis' in window)) { alert('Speech synthesis not supported'); return; }
  const s = window.speechSynthesis; s.cancel();
  const lines = [
    'Happy birthday to you',
    'Happy birthday to you',
    'Happy birthday dear Emily',
    'Happy birthday to you'
  ];
  let i = 0;
  function speakNext(){
    if (i>=lines.length) return;
    const u = new SpeechSynthesisUtterance(lines[i]);
    u.pitch = 1.08; u.rate = 0.95;
    const voices = s.getVoices();
    if (voices && voices.length) u.voice = voices.find(v=>/female|girl|samantha|amelia/i.test(v.name)) || voices[0];
    u.onend = ()=>{ i++; setTimeout(speakNext, 240); };
    s.speak(u);
    // also attempt to play audio file if available
    tryPlayAudio();
  }
  speakNext();
}

/* ---------- Buttons ---------- */
document.getElementById('playBtn').addEventListener('click', ()=>{ ensureAudio(); audioEl.currentTime = 0; audioEl.play().catch(()=>{}); });
document.getElementById('singBtn').addEventListener('click', ()=>{ singTTS(); });
document.getElementById('forceBtn').addEventListener('click', ()=>{ clearInterval(countdownInterval); openCelebration(); });

document.getElementById('replayBtn').addEventListener('click', ()=>{ // replay visuals & audio
  messagesContainer.innerHTML = ''; openCelebration();
});
document.getElementById('closeBtn').addEventListener('click', ()=>{ celebrateOverlay.classList.remove('show'); celebrateOverlay.setAttribute('aria-hidden','true'); });

/* ---------- Download & open handlers ---------- */
document.getElementById('downloadBtn').addEventListener('click', ()=>{
  const html = '<!doctype html>\\n' + document.documentElement.outerHTML;
  const blob = new Blob([html], {type:'text/html'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'emily-birthday.html'; a.click();
  URL.revokeObjectURL(url);
});
document.getElementById('openBtn').addEventListener('click', ()=> window.open(location.href, '_blank'));

/* ---------- Quick safety: if visitor already in KH target date, auto-trigger ---------- */
(function autoIfKHTarget(){
  const kh = nowInKH();
  const targetKH = new Date(targetUTC);
  // Compare KH date parts
  if (kh.getFullYear() === targetKH.getUTCFullYear() && kh.getMonth() === targetKH.getUTCMonth() && kh.getDate() === targetKH.getUTCDate()){
    setTimeout(()=>{ clearInterval(countdownInterval); openCelebration(); }, 700);
  }
})();
</script>
</body>
</html>
